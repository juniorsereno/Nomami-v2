services:
  nomami-app:
    build:
      context: ./nomami-app
      dockerfile: Dockerfile
    environment:
      # Node.js
      NODE_ENV: production
      LOG_LEVEL: warn
      
      # Database
      DATABASE_URL: ${DATABASE_URL}
      DATABASE_POOL_URL: ${DATABASE_POOL_URL}
      
      # Authentication (OBRIGATÃ“RIO)
      AUTH_SECRET: ${AUTH_SECRET}
      
      # Payment Gateway
      ASAAS_API_KEY: ${ASAAS_API_KEY}
      
      # Telemedicine
      TELEMEDICINE_API_USER: ${TELEMEDICINE_API_USER}
      TELEMEDICINE_API_PASSWORD: ${TELEMEDICINE_API_PASSWORD}
      TELEMEDICINE_WEBHOOK_URL: ${TELEMEDICINE_WEBHOOK_URL}
      
      # WhatsApp API (Evolution API)
      WHATSAPP_API_URL: ${WHATSAPP_API_URL}
      WHATSAPP_API_KEY: ${WHATSAPP_API_KEY}
      WHATSAPP_INSTANCE: ${WHATSAPP_INSTANCE}
    volumes:
      - uploads_data:/app/public/uploads
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M
    restart: unless-stopped

volumes:
  uploads_data:
